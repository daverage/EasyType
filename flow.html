<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AnchorFlow – Cadence Reading Demo</title>

<link rel="stylesheet"
      href="https://www.marczewski.me.uk/easytype/css/easytype.css?v=1.0.0"
      crossorigin="anonymous" />

<style>
:root{
  --bg:#fafafa; --card:#fff; --text:#141414; --muted:#666;
  --brand:#1AA6A6; --brand-dark:#0F5257; --lead-color:#0F5257;
  --radius:14px; --shadow:0 8px 24px rgba(0,0,0,.06);
}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:'EasyType Sans',system-ui,-apple-system,Segoe UI,Arial,sans-serif;
  line-height:1.7;
}
header{padding:24px 16px;border-bottom:1px solid #e8e8e8;
  background:linear-gradient(135deg,#f4ffff,#ffffff);}
h1{margin:.25rem 0 0;font-size:clamp(1.6rem,3.4vw,2.2rem);color:var(--brand-dark)}
p.subtitle{margin:.35rem 0 0;color:var(--muted)}
.wrap{max-width:1120px;margin:0 auto;padding:18px 16px 28px}
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
label{font-size:.92rem;color:var(--brand-dark);font-weight:600}
select,input[type="checkbox"]{padding:8px;border-radius:10px;border:1px solid #dcdcdc;background:#fff}
.controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.grid{display:grid;gap:16px;margin-top:16px}
.cols-2{grid-template-columns:1fr}
@media (min-width:960px){ .cols-2{grid-template-columns:1fr 1fr} }
.demo{padding:16px;border-radius:12px;border:1px dashed #e5e5e5;background:#fff;min-height:160px}
.demo h3{margin:.1rem 0 .35rem;font-size:1rem;color:var(--brand-dark)}
.small{color:var(--muted);font-size:.9rem}
.pill{display:inline-block;background:#eaf8f8;color:var(--brand-dark);
  border-radius:999px;padding:4px 10px;font-size:.78rem;font-weight:700;margin-right:6px}

/* AnchorFlow emphasis */
.af-lead{
  font-weight:800;
  font-synthesis:weight;
  text-shadow:0 .03em 0 currentColor,0 0 .02em currentColor;
  filter:brightness(0) contrast(140%);
}
.af-lead.tint{color:var(--lead-color)}
.af-tail.dim{opacity:.85}
</style>
</head>

<body>
<header class="wrap">
  <h1>AnchorFlow</h1>
  <p class="subtitle">Lead-in emphasis on a flowing global beat (spaces and punctuation skipped).</p>
</header>

<main class="wrap">
  <section class="card" style="margin-bottom:16px">
    <div class="controls">
      <label for="font">Font</label>
      <select id="font" aria-label="Font choice">
        <option value="EasyType Sans" selected>EasyType Sans</option>
        <option value="EasyType Focus">EasyType Focus</option>
        <option value="EasyType Dyslexic">EasyType Dyslexic</option>
        <option value="system">System sans</option>
      </select>
      <label class="small" style="display:flex;gap:6px;align-items:center;border:0">
        <input id="tint" type="checkbox" checked /> Tint lead-in
      </label>
    </div>

  </section>

  <section class="grid cols-2">
    <article class="card demo">
      <h3><span class="pill">A</span>Font only</h3>
      <p class="small">Internal anchoring and spacing. No extra highlighting.</p>
      <div id="outA"></div>
    </article>
    <article class="card demo">
      <h3><span class="pill">B</span>AnchorFlow – Cadence</h3>
      <p class="small">Lead-in emphasis with rhythm flowing across words.</p>
      <div id="outB"></div>
    </article>
  </section>

  <section class="card" style="margin-top:16px">
    <h2 style="margin:.1rem 0 .6rem;color:var(--brand-dark);font-size:1.2rem">Methodology and reasoning</h2>
    <ol class="small" style="margin:0;padding-left:1.2rem">
      <li><strong>Global beat.</strong> 6-character rhythm flows continuously, counting only letters and digits.</li>
      <li><strong>Lead length.</strong> 1–4 letters per word depending on length.</li>
      <li><strong>Cadence skips whitespace.</strong> Pauses act as natural breaks.</li>
      <li><strong>Simple A/B.</strong> Font-only vs AnchorFlow for clarity.</li>
    </ol>
  </section>
  <section class="card" style="margin-top:16px">
  <h2 style="margin:.1rem 0 .6rem;color:var(--brand-dark);font-size:1.2rem">
    Supporting Research
  </h2>
      <p class="small" style="color:#666">
  AnchorFlow’s design draws on peer-reviewed research in eye-movement science and visual perception, aligning text emphasis with measured reading rhythms.
</p>
  <ul class="small" style="margin:0;padding-left:1.2rem;line-height:1.6">
    <li>Rayner, K. (1998). <em>Eye Movements in Reading and Information Processing.</em> Psychological Bulletin, 124(3), 372–422.</li>
    <li>McConkie, G. W., & Rayner, K. (1975). <em>The Span of the Effective Stimulus During Reading.</em> Perception & Psychophysics, 17(6), 578–586.</li>
    <li>Pelli, D. G., et al. (2007). <em>The Crowding Phenomenon.</em> Annual Review of Vision Science, 3(1), 1–33.</li>
    <li>Ashby, J., & Clifton, C. (2005). <em>Eye Movements in Reading: Implications for Reading Speed and Fluency.</em> Handbook of Reading Research, Vol. 3.</li>
    <li>Larson, K. (2004). <em>The Science of Word Recognition.</em> Microsoft Typography White Paper.</li>
  </ul>
</section>
</main>

<script>
const SAMPLE = `The old clock in the town square chimed noon, a sound that echoed through the cobblestone streets. 
A young boy, no older than ten, sat on a bench, his eyes fixed on a small, worn leather-bound book. 
He wasn't reading, but rather tracing the embossed letters on the cover with a hesitant finger. 
He had found it tucked away in an old chest in his grandmother's attic, a treasure trove of forgotten stories. 
The book promised adventure, of a sort he'd only dreamed of. 
He knew, with a certainty that only a child could possess, that his life was about to change. 
He took a deep breath, opened the book to the first page, and began to read.`;

const fontEl = document.getElementById('font');
const tintEl = document.getElementById('tint');
const outA = document.getElementById('outA');
const outB = document.getElementById('outB');
const GLOBAL_BEAT = 6;

// helper: number of letters to highlight by word length
function leadByLen(len){
  if (len <= 3) return 1;
  if (len <= 6) return 2;
  if (len <= 8) return 3;
  return 4;
}

function buildAnchoredWord(word, tint){
  const leadCount = leadByLen(word.length);
  const wrap = document.createElement("span");
  wrap.className = "af-word";
  const s1 = document.createElement("span");
  s1.className = "af-lead" + (tint ? " tint" : "");
  s1.textContent = word.slice(0, leadCount);
  const s2 = document.createElement("span");
  s2.className = "af-tail dim";
  s2.textContent = word.slice(leadCount);
  wrap.append(s1, s2);
  return wrap;
}

// global beat that skips spaces/punctuation
function processCadence(text, tint){
  const frag = document.createDocumentFragment();
  const tokens = text.split(/(\s+)/);
  let charCount = 0;
  let nextBeat = GLOBAL_BEAT;

  for (const token of tokens){
    if (/^\s+$/.test(token)) { frag.append(token); continue; }

    if (!/[A-Za-z0-9]/.test(token)) { frag.append(token); continue; }

    const cleanPart = token.replace(/[^A-Za-z0-9]/g, '');
    const cleanLen = cleanPart.length;
    charCount += cleanLen;

    if (charCount >= nextBeat){
      const prefixMatch = token.match(/^[^A-Za-z0-9]+/);
      const suffixMatch = token.match(/[^A-Za-z0-9]+$/);
      const prefix = prefixMatch ? prefixMatch[0] : "";
      const suffix = suffixMatch ? suffixMatch[0] : "";
      const core = token.slice(prefix.length, token.length - suffix.length);
      if (prefix) frag.append(prefix);
      frag.append(buildAnchoredWord(core || token, tint));
      if (suffix) frag.append(suffix);
      while (charCount >= nextBeat) nextBeat += GLOBAL_BEAT; // advance to next beat threshold
    } else {
      frag.append(token);
    }
  }
  return frag;
}

function applyFont(el, fam){
  el.style.fontFamily = fam==='system'
    ? 'system-ui,-apple-system,Segoe UI,Arial,sans-serif'
    : `'${fam}', system-ui,-apple-system,Segoe UI,Arial,sans-serif`;
}

function update(){
  const fam = fontEl.value;
  const tint = tintEl.checked;
  applyFont(outA, fam);
  applyFont(outB, fam);
  outA.textContent = SAMPLE;
  outB.textContent = "";
  outB.append(processCadence(SAMPLE, tint));
}

fontEl.addEventListener("change", update);
tintEl.addEventListener("change", update);
document.fonts.ready.then(update);
</script>
</body>
</html>
